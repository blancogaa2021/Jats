context("[Audit] Selection")

### TEST 1: TAKING A MONETARY UNIT SAMPLE OF SIZE n = 200

options <- jasptools::analysisOptions("auditSelection")
options$.meta <- list(additionalVariables = list(containsColumn = TRUE), monetaryVariable = list(
    containsColumn = TRUE), rankingVariable = list(containsColumn = TRUE), 
    recordNumberVariable = list(containsColumn = TRUE), sampleIndicatorColumn = list(
        containsColumn = TRUE))
options$addSampleIndicator <- FALSE
options$displaySample <- TRUE
options$monetaryVariable <- "bookValue"
options$plotHistograms <- TRUE
options$recordNumberVariable <- "ID"
options$sampleDescriptives <- TRUE
options$sampleIndicatorColumn <- ""
options$sampleSize <- 200
options$selectionMethod <- "randomSampling"
options$selectionType <- "musSampling"
set.seed(1)
results <- jasptools::run("auditSelection", "BuildIt_Monetary.csv", options)


test_that("Test 1: Book values plot matches", {
	plotName <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_plotHistograms"]][["collection"]][["selectionContainer_plotHistograms_bookValue"]][["data"]]
	testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
	expect_equal_plots(testPlot, "Test 1: book-values", dir="auditSelection")
})

test_that("Test 1: <b>Table 2.</b> Selection Descriptive Statistics results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleDescriptivesTable"]][["data"]]
	expect_equal_tables(table,
		list(477.95175, 460.07, 189.768894246542, 200, "bookValue"))
})

test_that("Test 1: <b>Table 3.</b> Selected Observations results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleTable"]][["data"]]
	expect_equal_tables(table,
		list(1, 90260, 2174, 625.98, 1, 68595, 2928, 548.21, 1, 98301, 1627,
			 429.07, 1, 29683, 700, 239.26, 1, 72906, 147, 677.62, 1, 86317,
			 3056, 246.22, 1, 14548, 3118, 204.63, 1, 45416, 2045, 381.05,
			 1, 91955, 1311, 398.96, 1, 12815, 716, 873.43, 1, 99419, 956,
			 668.93, 1, 4838, 530, 701.64, 1, 89447, 1218, 367.23, 1, 71607,
			 1772, 540.71, 1, 86098, 2979, 323.9, 1, 76399, 2528, 469.06,
			 1, 85858, 3354, 349.41, 1, 32500, 662, 118.29, 1, 49057, 2868,
			 543.32, 1, 29132, 969, 320.19, 1, 85801, 308, 214.69, 1, 78043,
			 1858, 664.6, 1, 29378, 3061, 386.56, 1, 86438, 1047, 758.85,
			 1, 39905, 1574, 622.61, 1, 48046, 1248, 539.13, 1, 50725, 1108,
			 1073.76, 1, 72525, 326, 541.93, 1, 63557, 1115, 268.12, 1, 59284,
			 2616, 567.93, 1, 30644, 1366, 476.96, 1, 75319, 3179, 414.35,
			 1, 76073, 15, 469.93, 1, 41420, 3203, 689.6, 1, 84318, 2341,
			 292.3, 1, 61593, 97, 376.3, 1, 58263, 3195, 309.46, 1, 45828,
			 1418, 788.28, 1, 77635, 3304, 346.41, 1, 55567, 1842, 518.98,
			 1, 95755, 2453, 295.58, 1, 41150, 3435, 388.34, 1, 769, 1270,
			 317.21, 1, 45746, 136, 440.72, 1, 14628, 2584, 452.17, 1, 93255,
			 225, 312.5, 1, 71832, 3152, 1001.82, 1, 65768, 463, 480.89,
			 1, 72951, 2560, 341.16, 1, 31163, 515, 363.46, 1, 48921, 1622,
			 480.79, 1, 58329, 1693, 272.29, 1, 29396, 3365, 505.6, 1, 78162,
			 3223, 639.24, 1, 85195, 2396, 847.81, 1, 63825, 2473, 795.72,
			 1, 82902, 1532, 583.95, 1, 71580, 1261, 456.18, 1, 8094, 1409,
			 378.87, 1, 76607, 438, 523.32, 1, 63287, 2358, 235.61, 1, 71332,
			 2570, 599.73, 1, 67496, 1788, 491.41, 1, 56247, 3463, 571.88,
			 1, 31773, 836, 385.19, 1, 84756, 3134, 629.91, 1, 78346, 2505,
			 478.69, 1, 95137, 1187, 324.5, 1, 84375, 471, 824.66, 1, 29680,
			 1745, 262.45, 1, 76850, 1375, 567.95, 1, 13173, 2219, 283.69,
			 1, 43422, 2683, 561.68, 1, 16836, 586, 571.22, 1, 86092, 3357,
			 479.8, 1, 18092, 3005, 249.47, 1, 70991, 1438, 270.13, 1, 83096,
			 1355, 534.88, 1, 64305, 699, 319.68, 1, 70010, 156, 185.75,
			 1, 17092, 3121, 506.66, 1, 50867, 1650, 350.84, 1, 77556, 2282,
			 529.52, 1, 83130, 3041, 579.41, 1, 42935, 3420, 328.68, 1, 85306,
			 3349, 674.63, 1, 6771, 1267, 351.53, 1, 6122, 2476, 762.65,
			 1, 73814, 1345, 638.57, 1, 75887, 392, 739, 1, 93023, 3182,
			 642.94, 1, 23624, 2096, 876.04, 1, 43902, 2263, 388.92, 1, 30890,
			 729, 260.9, 1, 32267, 45, 318.45, 1, 86504, 885, 307, 1, 98030,
			 3324, 492.38, 1, 38946, 1827, 517.88, 1, 63297, 3191, 299.94,
			 1, 52741, 965, 409.8, 1, 64369, 972, 382.49, 1, 28971, 831,
			 558.38, 1, 20300, 2186, 619.51, 1, 37042, 914, 115.68, 1, 12112,
			 2579, 394, 1, 29538, 1604, 663.33, 1, 41334, 3219, 749.71, 1,
			 88695, 3272, 476.68, 1, 19030, 2919, 223.74, 1, 41242, 3254,
			 412.32, 1, 91889, 1878, 158.33, 1, 42588, 2412, 340.33, 1, 33036,
			 1111, 555.8, 1, 71713, 1852, 507.17, 1, 20853, 2521, 734.19,
			 1, 18608, 2102, 1090.25, 1, 93840, 3072, 348.33, 1, 35584, 3430,
			 790.6, 1, 48652, 2103, 497.21, 1, 83784, 1702, 389.55, 1, 30386,
			 313, 117.64, 1, 56338, 324, 465.67, 1, 28529, 1317, 471.97,
			 1, 84651, 2474, 702.38, 1, 34711, 2926, 328.79, 1, 8688, 2895,
			 492.02, 1, 95715, 2534, 457.42, 1, 92943, 2106, 666.35, 1, 86008,
			 3489, 649.08, 1, 12319, 1244, 414.12, 1, 72231, 2060, 423.53,
			 1, 83494, 1073, 836.53, 1, 36462, 1756, 926.01, 1, 80079, 287,
			 387.93, 1, 48714, 1285, 219.41, 1, 3188, 2821, 411.7, 1, 10842,
			 1423, 431.2, 1, 18286, 3172, 450.57, 1, 11067, 656, 140.44,
			 1, 15938, 3181, 459.47, 1, 33315, 1764, 365.65, 1, 57448, 3285,
			 410.49, 1, 53186, 2097, 642.34, 1, 72664, 2032, 627.35, 1, 19517,
			 1354, 340.07, 1, 36306, 2322, 493.42, 1, 2038, 1186, 701.22,
			 1, 70241, 2167, 331.58, 1, 450, 3373, 789.05, 1, 4225, 115,
			 268.65, 1, 95372, 2527, 402.76, 1, 80283, 1683, 433.12, 1, 81439,
			 2724, 573.24, 1, 3653, 2159, 492.39, 1, 73965, 2623, 463.01,
			 1, 99218, 645, 693.17, 1, 75234, 2812, 449.47, 1, 9392, 1731,
			 843.32, 1, 72138, 1431, 608.55, 1, 3976, 913, 660.59, 1, 11702,
			 2151, 604.13, 1, 93898, 2065, 245.64, 1, 66059, 694, 496.61,
			 1, 68766, 1578, 314.59, 1, 99617, 2408, 255.23, 1, 12016, 1494,
			 514.85, 1, 73038, 1269, 859.53, 1, 91323, 2069, 566.32, 1, 66191,
			 1013, 342.88, 1, 20335, 3082, 564.01, 1, 22862, 3485, 392.82,
			 1, 35486, 2739, 281.26, 1, 21337, 351, 272.84, 1, 26102, 3339,
			 531.24, 1, 99030, 1499, 539.68, 1, 13669, 1201, 244.48, 1, 63011,
			 3013, 385.17, 1, 54696, 608, 333.92, 1, 20736, 1685, 407.24,
			 1, 3400, 1012, 239.69, 1, 29133, 372, 597.44, 1, 13774, 1363,
			 684.14, 1, 45373, 2409, 251.31, 1, 89757, 1573, 460.67, 1, 2021,
			 3410, 257.99, 1, 18311, 2903, 685.88, 1, 55839, 1348, 325.53,
			 1, 821, 720, 342.25, 1, 74219, 2016, 202.69, 1, 36616, 1160,
			 439.7, 1, 82825, 1760, 348.9, 1, 72671, 739, 533.56, 1, 91495,
			 317, 794.48, 1, 87955, 557, 219.45, 1, 32406, 575, 606.48, 1,
			 48057, 68, 415.06, 1, 20634, 2352, 779.02, 1, 66200, 2950, 281.27,
			 1, 56012, 1949, 581.22, 1, 51328, 2627, 312.41))
})

test_that("Test 1: <b>Table 1.</b> Selection Summary results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_selectionInformationTable"]][["data"]]
	expect_equal_tables(table,
		list("6.81%", 200, "$ 95591"))
})

### TEST 2: TAKING A RECORD SAMPLE of n = 400 USING ONLY ID'S

options <- NULL

options <- jasptools::analysisOptions("auditSelection")
options$.meta <- list(additionalVariables = list(containsColumn = TRUE), monetaryVariable = list(
    containsColumn = TRUE), rankingVariable = list(containsColumn = TRUE), 
    recordNumberVariable = list(containsColumn = TRUE), sampleIndicatorColumn = list(
        containsColumn = TRUE))
options$addSampleIndicator <- FALSE
options$additionalVariables <- c("bookValue", "auditValue")
options$displaySample <- TRUE
options$recordNumberVariable <- "ID"
options$sampleDescriptives <- TRUE
options$sampleIndicatorColumn <- ""
options$sampleSize <- 400
options$seed <- 2
options$selectionMethod <- "systematicSampling"
options$selectionType <- "recordSampling"
set.seed(1)
results <- jasptools::run("auditSelection", "BuildIt_Monetary.csv", options)


test_that("Test 2: <b>Table 2.</b> Selection Descriptive Statistics results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleDescriptivesTable"]][["data"]]
	expect_equal_tables(table,
		list(415.420975, 370.54, 208.396699139718, 400, "bookValue", 412.530825,
		     368.29, 210.165826065237, 400, "auditValue"))
})

test_that("Test 2: <b>Table 3.</b> Selected Observations results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleTable"]][["data"]]
	expect_equal_tables(table,
	                    list(1, 25064, 2, 642.99, 642.99, 1, 79064, 10, 243.43, 243.43, 1,
	                         92464, 19, 76.76, 76.76, 1, 29777, 28, 560.23, 560.23, 1, 43450,
	                         37, 508.55, 508.55, 1, 32267, 45, 318.45, 318.45, 1, 81087,
	                         54, 379.26, 379.26, 1, 51272, 63, 248.4, 248.4, 1, 38968, 72,
	                         635.28, 635.28, 1, 24286, 80, 561.26, 561.26, 1, 31740, 89,
	                         735.45, 735.45, 1, 55002, 98, 328.13, 328.13, 1, 66000, 107,
	                         456.5, 456.5, 1, 4225, 115, 268.65, 268.65, 1, 46093, 124, 243.42,
	                         243.42, 1, 15769, 133, 186.81, 186.81, 1, 68676, 142, 612.46,
	                         612.46, 1, 13574, 150, 346.87, 346.87, 1, 60607, 159, 737.27,
	                         737.27, 1, 26061, 168, 178.95, 178.95, 1, 22515, 177, 167.07,
	                         167.07, 1, 62693, 185, 302.92, 302.92, 1, 60975, 194, 566.94,
	                         566.94, 1, 88668, 203, 274.96, 274.96, 1, 25063, 212, 740.99,
	                         740.99, 1, 4260, 220, 428.45, 428.45, 1, 56655, 229, 280.82,
	                         280.82, 1, 94223, 238, 811.7, 811.7, 1, 83880, 247, 697.3, 697.3,
	                         1, 30200, 255, 705.99, 705.99, 1, 92751, 264, 500.51, 500.51,
	                         1, 72845, 273, 398.17, 398.17, 1, 92032, 282, 321.49, 321.49,
	                         1, 4913, 290, 464.32, 464.32, 1, 27495, 299, 320.01, 320.01,
	                         1, 85801, 308, 214.69, 214.69, 1, 91495, 317, 794.48, 794.48,
	                         1, 57791, 325, 376, 376, 1, 59766, 334, 173.76, 173.76, 1, 10991,
	                         343, 133.92, 133.92, 1, 94854, 352, 141.08, 141.08, 1, 89437,
	                         360, 98.15, 98.15, 1, 89784, 369, 437.34, 437.34, 1, 33907,
	                         378, 475.63, 475.63, 1, 50787, 387, 173.28, 173.28, 1, 91293,
	                         395, 711.72, 711.72, 1, 69291, 404, 208.33, 208.33, 1, 49031,
	                         413, 377.31, 377.31, 1, 83951, 422, 288.15, 288.15, 1, 24835,
	                         430, 237, 237, 1, 21170, 439, 553.99, 553.99, 1, 14071, 448,
	                         267.99, 267.99, 1, 74280, 457, 132, 132, 1, 6641, 465, 687.51,
	                         687.51, 1, 44650, 474, 414.99, 414.99, 1, 9237, 483, 757.69,
	                         757.69, 1, 55315, 492, 117.59, 117.59, 1, 65509, 500, 343.22,
	                         343.22, 1, 14240, 509, 414.66, 414.66, 1, 47388, 518, 167.64,
	                         167.64, 1, 51481, 527, 179.01, 179.01, 1, 89333, 535, 362.28,
	                         362.28, 1, 84382, 544, 123.04, 123.04, 1, 32737, 553, 297.55,
	                         297.55, 1, 170, 562, 450.12, 450.12, 1, 41278, 570, 310.98,
	                         310.98, 1, 5712, 579, 833.33, 833.33, 1, 41417, 588, 251.22,
	                         251.22, 1, 93226, 597, 376.55, 376.55, 1, 19938, 605, 544.16,
	                         544.16, 1, 81774, 614, 32.81, 32.81, 1, 99538, 623, 486.18,
	                         486.18, 1, 18662, 632, 463.94, 463.94, 1, 45342, 640, 408.83,
	                         408.83, 1, 58576, 649, 79.7, 79.7, 1, 86118, 658, 558.87, 558.87,
	                         1, 81863, 667, 243.14, 243.14, 1, 79219, 675, 338.41, 338.41,
	                         1, 90641, 684, 347.52, 347.52, 1, 52164, 693, 395.91, 395.91,
	                         1, 52061, 702, 309.69, 309.69, 1, 66386, 710, 602.31, 602.31,
	                         1, 64893, 719, 234.73, 234.73, 1, 34803, 728, 328.56, 328.56,
	                         1, 80847, 737, 717.5, 717.5, 1, 49650, 745, 831.95, 831.95,
	                         1, 19191, 754, 487.99, 487.99, 1, 17332, 763, 594.54, 594.54,
	                         1, 8596, 772, 50.53, 50.53, 1, 77711, 780, 407.33, 407.33, 1,
	                         60604, 789, 307.86, 307.86, 1, 44256, 798, 378.99, 378.99, 1,
	                         43782, 807, 217.69, 217.69, 1, 85353, 815, 528.35, 528.35, 1,
	                         38298, 824, 243.16, 243.16, 1, 53865, 833, 145.17, 145.17, 1,
	                         84419, 842, 494.53, 494.53, 1, 35269, 850, 281.84, 281.84, 1,
	                         26683, 859, 520.86, 520.86, 1, 24950, 868, 514.57, 514.57, 1,
	                         29361, 877, 276.32, 276.32, 1, 86504, 885, 307, 307, 1, 14689,
	                         894, 249.24, 249.24, 1, 25837, 903, 175.87, 175.87, 1, 84412,
	                         912, 270.1, 270.1, 1, 76413, 920, 297.65, 297.65, 1, 38549,
	                         929, 336.55, 336.55, 1, 12426, 938, 940.11, 940.11, 1, 40300,
	                         947, 639.17, 639.17, 1, 72049, 955, 626.8, 626.8, 1, 13670,
	                         964, 181.17, 181.17, 1, 12210, 973, 330.11, 330.11, 1, 56074,
	                         982, 236.16, 236.16, 1, 28211, 990, 198.7, 198.7, 1, 42875,
	                         999, 553.65, 553.65, 1, 45429, 1008, 489.34, 489.34, 1, 50755,
	                         1017, 618.24, 618.24, 1, 38737, 1025, 237.09, 237.09, 1, 79440,
	                         1034, 299.11, 299.11, 1, 83468, 1043, 571.3, 571.3, 1, 30309,
	                         1052, 368.94, 368.94, 1, 4034, 1060, 96.66, 96.66, 1, 8499,
	                         1069, 631.06, 631.06, 1, 98581, 1078, 254.58, 254.58, 1, 57490,
	                         1087, 667.23, 667.23, 1, 92681, 1095, 257.03, 257.03, 1, 18923,
	                         1104, 527.82, 527.82, 1, 28178, 1113, 367.64, 367.64, 1, 20584,
	                         1122, 215.33, 215.33, 1, 84986, 1130, 200.18, 200.18, 1, 17506,
	                         1139, 156.15, 156.15, 1, 14979, 1148, 67.91, 169.77, 1, 97993,
	                         1157, 571.17, 571.17, 1, 59189, 1165, 186.49, 186.49, 1, 66795,
	                         1174, 408.66, 408.66, 1, 63430, 1183, 387.55, 387.55, 1, 37062,
	                         1192, 603.58, 603.58, 1, 69700, 1200, 453.84, 453.84, 1, 5434,
	                         1209, 430.5, 430.5, 1, 89447, 1218, 367.23, 367.23, 1, 67665,
	                         1227, 142.94, 357.35, 1, 61088, 1235, 226.37, 226.37, 1, 12319,
	                         1244, 414.12, 414.12, 1, 28198, 1253, 252.25, 252.25, 1, 67541,
	                         1262, 418.56, 418.56, 1, 769, 1270, 317.21, 317.21, 1, 56048,
	                         1279, 758.87, 758.87, 1, 43252, 1288, 156.35, 156.35, 1, 11343,
	                         1297, 471.04, 471.04, 1, 82701, 1305, 513.15, 513.15, 1, 26017,
	                         1314, 273.53, 273.53, 1, 10168, 1323, 558.19, 558.19, 1, 30593,
	                         1332, 278.41, 278.41, 1, 754, 1340, 395.82, 395.82, 1, 52733,
	                         1349, 589.18, 589.18, 1, 34579, 1358, 749.23, 749.23, 1, 36587,
	                         1367, 282.32, 282.32, 1, 76850, 1375, 567.95, 567.95, 1, 9490,
	                         1384, 238.22, 238.22, 1, 2474, 1393, 180.32, 180.32, 1, 55381,
	                         1402, 900.38, 900.38, 1, 75633, 1410, 466.78, 466.78, 1, 6928,
	                         1419, 208.86, 208.86, 1, 33462, 1428, 713.04, 713.04, 1, 13214,
	                         1437, 994.44, 994.44, 1, 47918, 1445, 330.7, 330.7, 1, 56670,
	                         1454, 494.14, 494.14, 1, 40897, 1463, 262.22, 262.22, 1, 71354,
	                         1472, 582.52, 582.52, 1, 38685, 1480, 350.41, 350.41, 1, 8019,
	                         1489, 769.5, 769.5, 1, 96565, 1498, 511.2, 511.2, 1, 40274,
	                         1507, 826.63, 826.63, 1, 38713, 1515, 753.11, 753.11, 1, 14016,
	                         1524, 281.76, 281.76, 1, 31051, 1533, 308.53, 308.53, 1, 57174,
	                         1542, 449.24, 449.24, 1, 54, 1550, 296.07, 296.07, 1, 38190,
	                         1559, 238.51, 238.51, 1, 16885, 1568, 116.05, 116.05, 1, 13497,
	                         1577, 381.3, 381.3, 1, 26926, 1585, 586.31, 586.31, 1, 7569,
	                         1594, 241.57, 241.57, 1, 10907, 1603, 344.23, 344.23, 1, 11739,
	                         1612, 446.29, 446.29, 1, 269, 1620, 342.03, 342.03, 1, 41471,
	                         1629, 576.28, 576.28, 1, 82772, 1638, 143.31, 143.31, 1, 27653,
	                         1647, 330.51, 330.51, 1, 88007, 1655, 284.7, 284.7, 1, 38368,
	                         1664, 223.3, 223.3, 1, 1679, 1673, 646.61, 646.61, 1, 71133,
	                         1682, 305.77, 305.77, 1, 47908, 1690, 348.02, 348.02, 1, 8437,
	                         1699, 194.89, 194.89, 1, 81853, 1708, 769.16, 769.16, 1, 64885,
	                         1717, 315.7, 315.7, 1, 3954, 1725, 327.28, 327.28, 1, 19188,
	                         1734, 264.74, 264.74, 1, 52285, 1743, 220.61, 220.61, 1, 93244,
	                         1752, 470.64, 470.64, 1, 82825, 1760, 348.9, 348.9, 1, 67174,
	                         1769, 364.6, 364.6, 1, 1604, 1778, 776.25, 776.25, 1, 24260,
	                         1787, 453.7, 453.7, 1, 95165, 1795, 454.41, 454.41, 1, 3210,
	                         1804, 153.84, 153.84, 1, 71016, 1813, 506.68, 506.68, 1, 65326,
	                         1822, 484.13, 484.13, 1, 52376, 1830, 349.55, 349.55, 1, 37044,
	                         1839, 654.61, 654.61, 1, 21107, 1848, 84.34, 210.85, 1, 23795,
	                         1857, 378.97, 378.97, 1, 82281, 1865, 317.97, 317.97, 1, 80544,
	                         1874, 693.17, 693.17, 1, 99497, 1883, 512.31, 512.31, 1, 44930,
	                         1892, 171.62, 171.62, 1, 23880, 1900, 400, 400, 1, 69132, 1909,
	                         283.92, 283.92, 1, 69379, 1918, 594.71, 594.71, 1, 27340, 1927,
	                         659.18, 659.18, 1, 51924, 1935, 294.94, 294.94, 1, 48532, 1944,
	                         450.44, 450.44, 1, 91577, 1953, 477.17, 477.17, 1, 46814, 1962,
	                         387.67, 387.67, 1, 79265, 1970, 357.21, 357.21, 1, 86489, 1979,
	                         491.35, 491.35, 1, 14729, 1988, 144.69, 144.69, 1, 69970, 1997,
	                         545.89, 545.89, 1, 36844, 2005, 272.96, 272.96, 1, 68924, 2014,
	                         331.87, 331.87, 1, 88010, 2023, 372.12, 372.12, 1, 72664, 2032,
	                         627.35, 627.35, 1, 27457, 2040, 253.68, 634.21, 1, 12113, 2049,
	                         276.25, 276.25, 1, 35189, 2058, 337.29, 337.29, 1, 33876, 2067,
	                         438.44, 438.44, 1, 29742, 2075, 554.85, 554.85, 1, 24103, 2084,
	                         409.05, 409.05, 1, 22819, 2093, 469.73, 469.73, 1, 18608, 2102,
	                         1090.25, 1090.25, 1, 67930, 2110, 426.47, 426.47, 1, 7603, 2119,
	                         409.08, 409.08, 1, 83612, 2128, 392.55, 392.55, 1, 51250, 2137,
	                         572.45, 572.45, 1, 45916, 2145, 542.97, 542.97, 1, 91342, 2154,
	                         118.2, 118.2, 1, 96806, 2163, 430.27, 430.27, 1, 36735, 2172,
	                         500.01, 500.01, 1, 79968, 2180, 544.51, 544.51, 1, 42699, 2189,
	                         266.45, 266.45, 1, 76862, 2198, 447.29, 447.29, 1, 74725, 2207,
	                         446.75, 446.75, 1, 43034, 2215, 278.83, 278.83, 1, 67747, 2224,
	                         201.92, 201.92, 1, 25451, 2233, 311.32, 311.32, 1, 61831, 2242,
	                         508.63, 508.63, 1, 35996, 2250, 61.31, 153.27, 1, 86731, 2259,
	                         281.14, 281.14, 1, 58790, 2268, 558.3, 558.3, 1, 83281, 2277,
	                         459.14, 459.14, 1, 42337, 2285, 784.74, 784.74, 1, 75486, 2294,
	                         430.68, 430.68, 1, 56953, 2303, 649.55, 649.55, 1, 84387, 2312,
	                         213.17, 213.17, 1, 93026, 2320, 303.1, 303.1, 1, 29919, 2329,
	                         681.1, 681.1, 1, 60368, 2338, 645.5, 645.5, 1, 75616, 2347,
	                         623.7, 623.7, 1, 49165, 2355, 514.31, 514.31, 1, 97399, 2364,
	                         241.98, 241.98, 1, 19372, 2373, 134.08, 134.08, 1, 93165, 2382,
	                         189.42, 189.42, 1, 82537, 2390, 800.67, 800.67, 1, 52199, 2399,
	                         308.89, 308.89, 1, 99617, 2408, 255.23, 255.23, 1, 83171, 2417,
	                         304.1, 304.1, 1, 82692, 2425, 202.95, 202.95, 1, 32174, 2434,
	                         207.65, 207.65, 1, 8864, 2443, 250.63, 250.63, 1, 53304, 2452,
	                         346.7, 346.7, 1, 86632, 2460, 231.01, 231.01, 1, 63268, 2469,
	                         420.54, 420.54, 1, 77392, 2478, 550.24, 550.24, 1, 76211, 2487,
	                         366.71, 366.71, 1, 7538, 2495, 183.46, 183.46, 1, 68151, 2504,
	                         464.06, 464.06, 1, 71123, 2513, 304.56, 304.56, 1, 37458, 2522,
	                         554.27, 554.27, 1, 28581, 2530, 438.41, 438.41, 1, 22516, 2539,
	                         507.16, 507.16, 1, 21144, 2548, 509.94, 509.94, 1, 94445, 2557,
	                         657.88, 657.88, 1, 62581, 2565, 377.49, 377.49, 1, 99146, 2574,
	                         353.19, 353.19, 1, 93767, 2583, 695.46, 695.46, 1, 23959, 2592,
	                         187.95, 187.95, 1, 14366, 2600, 310.6, 310.6, 1, 89946, 2609,
	                         734.09, 734.09, 1, 95414, 2618, 337.08, 337.08, 1, 51328, 2627,
	                         312.41, 312.41, 1, 81829, 2635, 287.27, 287.27, 1, 23653, 2644,
	                         289.5, 289.5, 1, 17218, 2653, 590.33, 590.33, 1, 30568, 2662,
	                         14.47, 14.47, 1, 87796, 2670, 177.97, 177.97, 1, 35420, 2679,
	                         320.63, 320.63, 1, 86621, 2688, 237.03, 237.03, 1, 13291, 2697,
	                         802.87, 802.87, 1, 79453, 2705, 368.96, 368.96, 1, 22730, 2714,
	                         252.55, 252.55, 1, 50938, 2723, 579.02, 579.02, 1, 97196, 2732,
	                         405.9, 405.9, 1, 35995, 2740, 630.45, 630.45, 1, 11105, 2749,
	                         191.35, 191.35, 1, 38221, 2758, 416.75, 416.75, 1, 12486, 2767,
	                         1064.23, 1064.23, 1, 15374, 2775, 526.51, 526.51, 1, 29087,
	                         2784, 291.47, 291.47, 1, 68460, 2793, 504.32, 504.32, 1, 80560,
	                         2802, 1150.9, 1150.9, 1, 55133, 2810, 709.73, 709.73, 1, 45248,
	                         2819, 290.35, 290.35, 1, 8068, 2828, 379.95, 379.95, 1, 25272,
	                         2837, 268.67, 268.67, 1, 12024, 2845, 648.87, 648.87, 1, 4613,
	                         2854, 626.21, 626.21, 1, 82794, 2863, 274.71, 274.71, 1, 46601,
	                         2872, 516.9, 516.9, 1, 76649, 2880, 465.22, 465.22, 1, 13787,
	                         2889, 486.61, 486.61, 1, 12845, 2898, 253.63, 253.63, 1, 81293,
	                         2907, 313.14, 313.14, 1, 33394, 2915, 449.16, 449.16, 1, 15776,
	                         2924, 791.64, 791.64, 1, 83692, 2933, 271.64, 271.64, 1, 38318,
	                         2942, 303.36, 303.36, 1, 66200, 2950, 281.27, 281.27, 1, 32895,
	                         2959, 374.39, 374.39, 1, 2594, 2968, 296.29, 296.29, 1, 77769,
	                         2977, 207.21, 207.21, 1, 46224, 2985, 796.95, 796.95, 1, 78677,
	                         2994, 110.34, 110.34, 1, 98879, 3003, 638.36, 638.36, 1, 68814,
	                         3012, 319.1, 319.1, 1, 8716, 3020, 450.76, 450.76, 1, 52121,
	                         3029, 993.57, 993.57, 1, 99256, 3038, 259.72, 259.72, 1, 13359,
	                         3047, 1262.85, 1262.85, 1, 14517, 3055, 279.62, 279.62, 1, 6080,
	                         3064, 722.45, 722.45, 1, 1313, 3073, 170.44, 170.44, 1, 20335,
	                         3082, 564.01, 564.01, 1, 66843, 3090, 211.44, 211.44, 1, 47461,
	                         3099, 313.42, 313.42, 1, 87494, 3108, 489.8, 489.8, 1, 53751,
	                         3117, 320.1, 320.1, 1, 46700, 3125, 974.81, 974.81, 1, 84756,
	                         3134, 629.91, 629.91, 1, 22831, 3143, 478.89, 478.89, 1, 71832,
	                         3152, 1001.82, 1001.82, 1, 99264, 3160, 367.06, 367.06, 1, 77405,
	                         3169, 907.06, 907.06, 1, 75182, 3178, 217.49, 217.49, 1, 67180,
	                         3187, 254.39, 254.39, 1, 58263, 3195, 309.46, 309.46, 1, 10447,
	                         3204, 318.29, 318.29, 1, 76282, 3213, 192.2, 192.2, 1, 90783,
	                         3222, 543.95, 543.95, 1, 74531, 3230, 844.36, 844.36, 1, 99350,
	                         3239, 530.47, 530.47, 1, 24908, 3248, 464.04, 464.04, 1, 29389,
	                         3257, 587.66, 587.66, 1, 47302, 3265, 236.57, 236.57, 1, 35451,
	                         3274, 300.36, 300.36, 1, 25908, 3283, 530.74, 530.74, 1, 2111,
	                         3292, 215.07, 215.07, 1, 29907, 3300, 719.5, 719.5, 1, 4347,
	                         3309, 219.42, 219.42, 1, 87942, 3318, 276.54, 276.54, 1, 28765,
	                         3327, 207.14, 207.14, 1, 9733, 3335, 275.75, 275.75, 1, 24337,
	                         3344, 281.27, 281.27, 1, 13965, 3353, 281.28, 281.28, 1, 91263,
	                         3362, 659.14, 659.14, 1, 11073, 3370, 196.01, 196.01, 1, 85322,
	                         3379, 330.24, 330.24, 1, 82564, 3388, 160.52, 401.31, 1, 93169,
	                         3397, 530.82, 530.82, 1, 15927, 3405, 438.36, 438.36, 1, 25121,
	                         3414, 702.38, 702.38, 1, 53133, 3423, 321, 321, 1, 10878, 3432,
	                         122.84, 122.84, 1, 43681, 3440, 781.39, 781.39, 1, 52526, 3449,
	                         116.25, 116.25, 1, 1369, 3458, 489.43, 489.43, 1, 21104, 3467,
	                         801.5, 801.5, 1, 92971, 3475, 98.6, 98.6, 1, 23486, 3484, 383.19,
	                         383.19, 1, 83627, 3493, 247.31, 247.31))
})

test_that("Test 2: <b>Table 1.</b> Selection Summary results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_selectionInformationTable"]][["data"]]
	expect_equal_tables(table,
		list(9, "11.43%", 400))
})

### TEST 3: SELECTION USING auditRattle.csv DATASET

options <- jasptools::analysisOptions("auditSelection")
options$.meta <- list(additionalVariables = list(containsColumn = TRUE), monetaryVariable = list(
    containsColumn = TRUE), rankingVariable = list(containsColumn = TRUE), 
    recordNumberVariable = list(containsColumn = TRUE), sampleIndicatorColumn = list(
        containsColumn = TRUE))
options$addSampleIndicator <- FALSE
options$displaySample <- TRUE
options$monetaryVariable <- "Deductions"
options$plotHistograms <- TRUE
options$recordNumberVariable <- "ID"
options$sampleDescriptives <- TRUE
options$sampleIndicatorColumn <- ""
options$sampleSize <- 40
options$selectionMethod <- "randomSampling"
options$selectionType <- "musSampling"
set.seed(1)
results <- jasptools::run("auditSelection", "auditRattle.csv", options)


test_that("Test 3: Book values plot matches", {
	plotName <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_plotHistograms"]][["collection"]][["selectionContainer_plotHistograms_Deductions"]][["data"]]
	testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
	expect_equal_plots(testPlot, "Test 3: book-values", dir="auditSelection")
})

test_that("Test 3: <b>Table 2.</b> Selection Descriptive Statistics results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleDescriptivesTable"]][["data"]]
	expect_equal_tables(table,
		list(1724.16666666667, 1887, 489.370128335519, 40, "Deductions"))
})

test_that("Test 3: <b>Table 3.</b> Selected Observations results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleTable"]][["data"]]
	expect_equal_tables(table,
		list(1, 1977, 4153176, 29, 1, 1902, 9019764, 73, 1, 1848, 3465197,
			 19, 1, 1098.66666666667, 3813044, 22, 1, 2246, 1222601, 1, 1,
			 1114.66666666667, 4823221, 37, 1, 1060, 3883555, 23, 1, 1559.33333333333,
			 8299017, 68, 1, 1568, 4579400, 36, 1, 2513.33333333333, 6646979,
			 53, 1, 2174, 2511963, 14, 1, 2246, 6924609, 55, 1, 1492, 8304027,
			 69, 1, 1902, 4909545, 38, 1, 1316, 3982518, 25, 1, 1887, 1545759,
			 3, 1, 1367.33333333333, 2434068, 13, 1, 649.333333333333, 4031521,
			 28, 1, 1902, 2242093, 10, 1, 1250.66666666667, 1797445, 5, 1,
			 1068, 9466933, 77, 1, 2174, 2161054, 8, 1, 1564, 4031109, 27,
			 1, 2415, 6078926, 48, 1, 1977, 7618649, 63, 1, 1902, 3406334,
			 17, 1, 2904, 7930929, 65, 1, 1902, 5634257, 43, 1, 1114.66666666667,
			 5293006, 42, 1, 1902, 7547024, 60, 1, 1887, 8095545, 66, 1,
			 1564, 4209493, 31, 1, 1887, 5649072, 44, 1, 2258, 5994090, 46,
			 1, 1147.33333333333, 8554333, 71, 1, 1452.66666666667, 3433750,
			 18, 1, 1160.66666666667, 9126219, 74, 1, 2392, 6219246, 49,
			 1, 1320, 2361729, 12, 1, 1902, 1597428, 4))
})

test_that("Test 3: <b>Table 1.</b> Selection Summary results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_selectionInformationTable"]][["data"]]
	expect_equal_tables(table,
		list("51.04%", 40, "$ 68967"))
})
