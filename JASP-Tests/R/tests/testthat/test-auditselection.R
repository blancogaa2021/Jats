context("[Audit] Selection")

### TEST 1: TAKING A MONETARY UNIT SAMPLE OF SIZE n = 200

options <- jasptools::analysisOptions("auditSelection")
options$.meta <- list(additionalVariables = list(containsColumn = TRUE), monetaryVariable = list(
    containsColumn = TRUE), rankingVariable = list(containsColumn = TRUE), 
    recordNumberVariable = list(containsColumn = TRUE), sampleIndicatorColumn = list(
        containsColumn = TRUE))
options$addSampleIndicator <- FALSE
options$displaySample <- TRUE
options$monetaryVariable <- "bookValue"
options$plotHistograms <- TRUE
options$recordNumberVariable <- "ID"
options$sampleDescriptives <- TRUE
options$sampleIndicatorColumn <- ""
options$sampleSize <- 200
options$selectionMethod <- "randomSampling"
options$selectionType <- "musSampling"
set.seed(1)
results <- jasptools::run("auditSelection", "BuildIt_Monetary.csv", options)


test_that("Test 1: Book values plot matches", {
	plotName <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_plotHistograms"]][["collection"]][["selectionContainer_plotHistograms_bookValue"]][["data"]]
	testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
	expect_equal_plots(testPlot, "Test 1: book-values", dir="auditSelection")
})

test_that("Test 1: <b>Table 2.</b> Selection Descriptive Statistics results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleDescriptivesTable"]][["data"]]
	expect_equal_tables(table,
		list(477.95175, 460.07, 189.768894246542, 200, "bookValue"))
})

test_that("Test 1: <b>Table 3.</b> Selected Observations results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleTable"]][["data"]]
	expect_equal_tables(table,
		list(1, 90260, 2174, 625.98, 1, 68595, 2928, 548.21, 1, 98301, 1627,
			 429.07, 1, 29683, 700, 239.26, 1, 72906, 147, 677.62, 1, 86317,
			 3056, 246.22, 1, 14548, 3118, 204.63, 1, 45416, 2045, 381.05,
			 1, 91955, 1311, 398.96, 1, 12815, 716, 873.43, 1, 99419, 956,
			 668.93, 1, 4838, 530, 701.64, 1, 89447, 1218, 367.23, 1, 71607,
			 1772, 540.71, 1, 86098, 2979, 323.9, 1, 76399, 2528, 469.06,
			 1, 85858, 3354, 349.41, 1, 32500, 662, 118.29, 1, 49057, 2868,
			 543.32, 1, 29132, 969, 320.19, 1, 85801, 308, 214.69, 1, 78043,
			 1858, 664.6, 1, 29378, 3061, 386.56, 1, 86438, 1047, 758.85,
			 1, 39905, 1574, 622.61, 1, 48046, 1248, 539.13, 1, 50725, 1108,
			 1073.76, 1, 72525, 326, 541.93, 1, 63557, 1115, 268.12, 1, 59284,
			 2616, 567.93, 1, 30644, 1366, 476.96, 1, 75319, 3179, 414.35,
			 1, 76073, 15, 469.93, 1, 41420, 3203, 689.6, 1, 84318, 2341,
			 292.3, 1, 61593, 97, 376.3, 1, 58263, 3195, 309.46, 1, 45828,
			 1418, 788.28, 1, 77635, 3304, 346.41, 1, 55567, 1842, 518.98,
			 1, 95755, 2453, 295.58, 1, 41150, 3435, 388.34, 1, 769, 1270,
			 317.21, 1, 45746, 136, 440.72, 1, 14628, 2584, 452.17, 1, 93255,
			 225, 312.5, 1, 71832, 3152, 1001.82, 1, 65768, 463, 480.89,
			 1, 72951, 2560, 341.16, 1, 31163, 515, 363.46, 1, 48921, 1622,
			 480.79, 1, 58329, 1693, 272.29, 1, 29396, 3365, 505.6, 1, 78162,
			 3223, 639.24, 1, 85195, 2396, 847.81, 1, 63825, 2473, 795.72,
			 1, 82902, 1532, 583.95, 1, 71580, 1261, 456.18, 1, 8094, 1409,
			 378.87, 1, 76607, 438, 523.32, 1, 63287, 2358, 235.61, 1, 71332,
			 2570, 599.73, 1, 67496, 1788, 491.41, 1, 56247, 3463, 571.88,
			 1, 31773, 836, 385.19, 1, 84756, 3134, 629.91, 1, 78346, 2505,
			 478.69, 1, 95137, 1187, 324.5, 1, 84375, 471, 824.66, 1, 29680,
			 1745, 262.45, 1, 76850, 1375, 567.95, 1, 13173, 2219, 283.69,
			 1, 43422, 2683, 561.68, 1, 16836, 586, 571.22, 1, 86092, 3357,
			 479.8, 1, 18092, 3005, 249.47, 1, 70991, 1438, 270.13, 1, 83096,
			 1355, 534.88, 1, 64305, 699, 319.68, 1, 70010, 156, 185.75,
			 1, 17092, 3121, 506.66, 1, 50867, 1650, 350.84, 1, 77556, 2282,
			 529.52, 1, 83130, 3041, 579.41, 1, 42935, 3420, 328.68, 1, 85306,
			 3349, 674.63, 1, 6771, 1267, 351.53, 1, 6122, 2476, 762.65,
			 1, 73814, 1345, 638.57, 1, 75887, 392, 739, 1, 93023, 3182,
			 642.94, 1, 23624, 2096, 876.04, 1, 43902, 2263, 388.92, 1, 30890,
			 729, 260.9, 1, 32267, 45, 318.45, 1, 86504, 885, 307, 1, 98030,
			 3324, 492.38, 1, 38946, 1827, 517.88, 1, 63297, 3191, 299.94,
			 1, 52741, 965, 409.8, 1, 64369, 972, 382.49, 1, 28971, 831,
			 558.38, 1, 20300, 2186, 619.51, 1, 37042, 914, 115.68, 1, 12112,
			 2579, 394, 1, 29538, 1604, 663.33, 1, 41334, 3219, 749.71, 1,
			 88695, 3272, 476.68, 1, 19030, 2919, 223.74, 1, 41242, 3254,
			 412.32, 1, 91889, 1878, 158.33, 1, 42588, 2412, 340.33, 1, 33036,
			 1111, 555.8, 1, 71713, 1852, 507.17, 1, 20853, 2521, 734.19,
			 1, 18608, 2102, 1090.25, 1, 93840, 3072, 348.33, 1, 35584, 3430,
			 790.6, 1, 48652, 2103, 497.21, 1, 83784, 1702, 389.55, 1, 30386,
			 313, 117.64, 1, 56338, 324, 465.67, 1, 28529, 1317, 471.97,
			 1, 84651, 2474, 702.38, 1, 34711, 2926, 328.79, 1, 8688, 2895,
			 492.02, 1, 95715, 2534, 457.42, 1, 92943, 2106, 666.35, 1, 86008,
			 3489, 649.08, 1, 12319, 1244, 414.12, 1, 72231, 2060, 423.53,
			 1, 83494, 1073, 836.53, 1, 36462, 1756, 926.01, 1, 80079, 287,
			 387.93, 1, 48714, 1285, 219.41, 1, 3188, 2821, 411.7, 1, 10842,
			 1423, 431.2, 1, 18286, 3172, 450.57, 1, 11067, 656, 140.44,
			 1, 15938, 3181, 459.47, 1, 33315, 1764, 365.65, 1, 57448, 3285,
			 410.49, 1, 53186, 2097, 642.34, 1, 72664, 2032, 627.35, 1, 19517,
			 1354, 340.07, 1, 36306, 2322, 493.42, 1, 2038, 1186, 701.22,
			 1, 70241, 2167, 331.58, 1, 450, 3373, 789.05, 1, 4225, 115,
			 268.65, 1, 95372, 2527, 402.76, 1, 80283, 1683, 433.12, 1, 81439,
			 2724, 573.24, 1, 3653, 2159, 492.39, 1, 73965, 2623, 463.01,
			 1, 99218, 645, 693.17, 1, 75234, 2812, 449.47, 1, 9392, 1731,
			 843.32, 1, 72138, 1431, 608.55, 1, 3976, 913, 660.59, 1, 11702,
			 2151, 604.13, 1, 93898, 2065, 245.64, 1, 66059, 694, 496.61,
			 1, 68766, 1578, 314.59, 1, 99617, 2408, 255.23, 1, 12016, 1494,
			 514.85, 1, 73038, 1269, 859.53, 1, 91323, 2069, 566.32, 1, 66191,
			 1013, 342.88, 1, 20335, 3082, 564.01, 1, 22862, 3485, 392.82,
			 1, 35486, 2739, 281.26, 1, 21337, 351, 272.84, 1, 26102, 3339,
			 531.24, 1, 99030, 1499, 539.68, 1, 13669, 1201, 244.48, 1, 63011,
			 3013, 385.17, 1, 54696, 608, 333.92, 1, 20736, 1685, 407.24,
			 1, 3400, 1012, 239.69, 1, 29133, 372, 597.44, 1, 13774, 1363,
			 684.14, 1, 45373, 2409, 251.31, 1, 89757, 1573, 460.67, 1, 2021,
			 3410, 257.99, 1, 18311, 2903, 685.88, 1, 55839, 1348, 325.53,
			 1, 821, 720, 342.25, 1, 74219, 2016, 202.69, 1, 36616, 1160,
			 439.7, 1, 82825, 1760, 348.9, 1, 72671, 739, 533.56, 1, 91495,
			 317, 794.48, 1, 87955, 557, 219.45, 1, 32406, 575, 606.48, 1,
			 48057, 68, 415.06, 1, 20634, 2352, 779.02, 1, 66200, 2950, 281.27,
			 1, 56012, 1949, 581.22, 1, 51328, 2627, 312.41))
})

test_that("Test 1: <b>Table 1.</b> Selection Summary results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_selectionInformationTable"]][["data"]]
	expect_equal_tables(table,
		list("6.81%", 200, "$ 95591"))
})

### TEST 2: TAKING A RECORD SAMPLE of n = 400 USING ONLY ID'S

options <- NULL

options <- jasptools::analysisOptions("auditSelection")
options$.meta <- list(additionalVariables = list(containsColumn = TRUE), monetaryVariable = list(
    containsColumn = TRUE), rankingVariable = list(containsColumn = TRUE), 
    recordNumberVariable = list(containsColumn = TRUE), sampleIndicatorColumn = list(
        containsColumn = TRUE))
options$addSampleIndicator <- FALSE
options$additionalVariables <- c("bookValue", "auditValue")
options$displaySample <- TRUE
options$recordNumberVariable <- "ID"
options$sampleDescriptives <- TRUE
options$sampleIndicatorColumn <- ""
options$sampleSize <- 400
options$seed <- 2
options$selectionMethod <- "systematicSampling"
options$selectionType <- "recordSampling"
set.seed(1)
results <- jasptools::run("auditSelection", "BuildIt_Monetary.csv", options)


test_that("Test 2: <b>Table 2.</b> Selection Descriptive Statistics results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleDescriptivesTable"]][["data"]]
	expect_equal_tables(table,
		list(407.13405, 364.825, 199.187753530403, 400, "bookValue", 403.927925,
			 363.95, 201.448704895824, 400, "auditValue"))
})

test_that("Test 2: <b>Table 3.</b> Selected Observations results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleTable"]][["data"]]
	expect_equal_tables(table,
		list(1, 25064, 2, 642.99, 642.99, 1, 6227, 11, 296.26, 296.26, 1, 15611,
			 20, 450.56, 450.56, 1, 58849, 29, 274.26, 274.26, 1, 57172,
			 38, 329.3, 329.3, 1, 53784, 47, 325.19, 325.19, 1, 95532, 56,
			 444.61, 444.61, 1, 74733, 65, 509.36, 509.36, 1, 44016, 74,
			 600.75, 600.75, 1, 66252, 83, 200.33, 200.33, 1, 75133, 92,
			 355.16, 355.16, 1, 64282, 101, 172.65, 172.65, 1, 4756, 110,
			 295.96, 295.96, 1, 66939, 119, 714.26, 714.26, 1, 13081, 128,
			 734.93, 734.93, 1, 79417, 137, 335.71, 335.71, 1, 90183, 146,
			 333.28, 333.28, 1, 36290, 155, 179.22, 179.22, 1, 38561, 164,
			 458.6, 458.6, 1, 32752, 173, 112.07, 112.07, 1, 27070, 182,
			 699.51, 699.51, 1, 36460, 191, 173.51, 173.51, 1, 89813, 200,
			 334.73, 334.73, 1, 68667, 209, 275.47, 275.47, 1, 11890, 218,
			 296.31, 296.31, 1, 49529, 227, 435.84, 435.84, 1, 55672, 236,
			 327.11, 327.11, 1, 48325, 245, 270.19, 270.19, 1, 85522, 254,
			 87.6, 87.6, 1, 54284, 263, 209.97, 209.97, 1, 96619, 272, 136.05,
			 136.05, 1, 20770, 281, 336.12, 336.12, 1, 4913, 290, 464.32,
			 464.32, 1, 27495, 299, 320.01, 320.01, 1, 85801, 308, 214.69,
			 214.69, 1, 91495, 317, 794.48, 794.48, 1, 72525, 326, 541.93,
			 541.93, 1, 9782, 335, 337.93, 337.93, 1, 15197, 344, 536.77,
			 536.77, 1, 81354, 353, 961.28, 961.28, 1, 14846, 362, 350.91,
			 350.91, 1, 94414, 371, 146.78, 146.78, 1, 23831, 380, 769.89,
			 769.89, 1, 61608, 389, 418.06, 418.06, 1, 93179, 398, 257.14,
			 257.14, 1, 78215, 407, 350.77, 350.77, 1, 26163, 416, 108.23,
			 270.58, 1, 71462, 425, 640.12, 640.12, 1, 16910, 434, 446.6,
			 446.6, 1, 32859, 443, 305.23, 305.23, 1, 16688, 452, 271.87,
			 271.87, 1, 51855, 461, 690.06, 690.06, 1, 37508, 470, 249.83,
			 249.83, 1, 71824, 479, 305.14, 305.14, 1, 50811, 488, 651.35,
			 651.35, 1, 8847, 497, 397.11, 397.11, 1, 53945, 506, 846.85,
			 846.85, 1, 31163, 515, 363.46, 363.46, 1, 12052, 524, 580.69,
			 580.69, 1, 66816, 533, 239.39, 239.39, 1, 63010, 542, 347.38,
			 347.38, 1, 6514, 551, 530.06, 530.06, 1, 97331, 560, 227.75,
			 227.75, 1, 94368, 569, 313.83, 313.83, 1, 83566, 578, 296.99,
			 296.99, 1, 83304, 587, 759.15, 759.15, 1, 11502, 596, 147.89,
			 147.89, 1, 19938, 605, 544.16, 544.16, 1, 81774, 614, 32.81,
			 32.81, 1, 99538, 623, 486.18, 486.18, 1, 18662, 632, 463.94,
			 463.94, 1, 58370, 641, 182.14, 182.14, 1, 21842, 650, 117.59,
			 117.59, 1, 64847, 659, 217.14, 217.14, 1, 31451, 668, 249, 622.51,
			 1, 85062, 677, 302.78, 302.78, 1, 92723, 686, 345.42, 345.42,
			 1, 31283, 695, 196.44, 196.44, 1, 25087, 704, 501.51, 501.51,
			 1, 87348, 713, 92.06, 92.06, 1, 85841, 722, 395.38, 395.38,
			 1, 4782, 731, 311.33, 311.33, 1, 96915, 740, 193.65, 193.65,
			 1, 85033, 749, 264.85, 264.85, 1, 17810, 758, 373.01, 373.01,
			 1, 33030, 767, 108.06, 108.06, 1, 92923, 776, 247.89, 247.89,
			 1, 52619, 785, 279.44, 279.44, 1, 76865, 794, 198.12, 198.12,
			 1, 91330, 803, 304.58, 304.58, 1, 57201, 812, 513.07, 513.07,
			 1, 56212, 821, 324.15, 324.15, 1, 19678, 830, 289.67, 289.67,
			 1, 25008, 839, 448.07, 448.07, 1, 77094, 848, 221.34, 221.34,
			 1, 26870, 857, 346.21, 346.21, 1, 1469, 866, 72.57, 72.57, 1,
			 82047, 875, 249.68, 249.68, 1, 47761, 884, 452.95, 452.95, 1,
			 94753, 893, 1171.55, 1171.55, 1, 98110, 902, 617.6, 617.6, 1,
			 67506, 911, 314.29, 314.29, 1, 76413, 920, 297.65, 297.65, 1,
			 38549, 929, 336.55, 336.55, 1, 12426, 938, 940.11, 940.11, 1,
			 40300, 947, 639.17, 639.17, 1, 99419, 956, 668.93, 668.93, 1,
			 52741, 965, 409.8, 409.8, 1, 55241, 974, 240.11, 240.11, 1,
			 65353, 983, 486.48, 486.48, 1, 47424, 992, 469.18, 469.18, 1,
			 26298, 1001, 339.16, 339.16, 1, 92166, 1010, 566.01, 566.01,
			 1, 51851, 1019, 550.07, 550.07, 1, 67675, 1028, 231.67, 231.67,
			 1, 11808, 1037, 397.04, 397.04, 1, 35529, 1046, 242.01, 242.01,
			 1, 66675, 1055, 384.27, 384.27, 1, 99993, 1064, 732.09, 732.09,
			 1, 83494, 1073, 836.53, 836.53, 1, 68732, 1082, 357.02, 357.02,
			 1, 33799, 1091, 177.53, 177.53, 1, 11161, 1100, 688.87, 688.87,
			 1, 79838, 1109, 412.33, 412.33, 1, 16350, 1118, 581.88, 581.88,
			 1, 42553, 1127, 371.73, 371.73, 1, 79238, 1136, 642.84, 642.84,
			 1, 85385, 1145, 275.95, 275.95, 1, 24395, 1154, 737.85, 737.85,
			 1, 77743, 1163, 402.29, 402.29, 1, 5020, 1172, 369.43, 369.43,
			 1, 14733, 1181, 257.71, 257.71, 1, 16148, 1190, 304.25, 304.25,
			 1, 580, 1199, 519.81, 519.81, 1, 32675, 1208, 413.54, 413.54,
			 1, 74255, 1217, 365.21, 365.21, 1, 23198, 1226, 735.87, 735.87,
			 1, 61088, 1235, 226.37, 226.37, 1, 12319, 1244, 414.12, 414.12,
			 1, 28198, 1253, 252.25, 252.25, 1, 67541, 1262, 418.56, 418.56,
			 1, 50684, 1271, 519.79, 519.79, 1, 76278, 1280, 294.58, 294.58,
			 1, 69109, 1289, 282.86, 282.86, 1, 9163, 1298, 906.8, 906.8,
			 1, 22119, 1307, 344.89, 344.89, 1, 7687, 1316, 980.55, 980.55,
			 1, 10518, 1325, 247.19, 247.19, 1, 87688, 1334, 388.63, 388.63,
			 1, 5841, 1343, 299.66, 299.66, 1, 93474, 1352, 371.55, 371.55,
			 1, 18653, 1361, 700.78, 700.78, 1, 2162, 1370, 256.01, 256.01,
			 1, 26211, 1379, 542.82, 542.82, 1, 58181, 1388, 273.21, 273.21,
			 1, 70085, 1397, 322.5, 322.5, 1, 54833, 1406, 165.68, 165.68,
			 1, 65540, 1415, 356.03, 356.03, 1, 73509, 1424, 266.04, 266.04,
			 1, 83748, 1433, 153.2, 153.2, 1, 24329, 1442, 149.44, 149.44,
			 1, 18684, 1451, 309.6, 309.6, 1, 74303, 1460, 228.39, 228.39,
			 1, 42184, 1469, 194.88, 194.88, 1, 35595, 1478, 442.87, 442.87,
			 1, 45542, 1487, 339.63, 339.63, 1, 46707, 1496, 210.87, 210.87,
			 1, 48139, 1505, 718.58, 718.58, 1, 598, 1514, 302.77, 302.77,
			 1, 38880, 1523, 655.94, 655.94, 1, 82902, 1532, 583.95, 583.95,
			 1, 21839, 1541, 340.02, 340.02, 1, 54, 1550, 296.07, 296.07,
			 1, 38190, 1559, 238.51, 238.51, 1, 16885, 1568, 116.05, 116.05,
			 1, 13497, 1577, 381.3, 381.3, 1, 98342, 1586, 155.36, 155.36,
			 1, 80674, 1595, 340.72, 340.72, 1, 29538, 1604, 663.33, 663.33,
			 1, 54128, 1613, 265.98, 265.98, 1, 48921, 1622, 480.79, 480.79,
			 1, 66109, 1631, 517.77, 517.77, 1, 87617, 1640, 259.97, 259.97,
			 1, 16943, 1649, 255.92, 255.92, 1, 88110, 1658, 277.39, 277.39,
			 1, 80955, 1667, 110.02, 275.06, 1, 56714, 1676, 733.25, 733.25,
			 1, 20736, 1685, 407.24, 407.24, 1, 85907, 1694, 394.43, 394.43,
			 1, 50655, 1703, 238.34, 238.34, 1, 44122, 1712, 401, 401, 1,
			 35982, 1721, 829.17, 829.17, 1, 64142, 1730, 202.72, 202.72,
			 1, 7710, 1739, 531.54, 531.54, 1, 78666, 1748, 195.23, 195.23,
			 1, 40708, 1757, 252.93, 252.93, 1, 7993, 1766, 147.13, 147.13,
			 1, 46621, 1775, 148.01, 148.01, 1, 79855, 1784, 462.62, 462.62,
			 1, 52967, 1793, 391.3, 391.3, 1, 94145, 1802, 290.32, 290.32,
			 1, 23904, 1811, 516.94, 516.94, 1, 82309, 1820, 796.31, 796.31,
			 1, 21343, 1829, 490.59, 490.59, 1, 57143, 1838, 105.63, 105.63,
			 1, 39946, 1847, 116.15, 290.38, 1, 76131, 1856, 198.23, 198.23,
			 1, 82281, 1865, 317.97, 317.97, 1, 80544, 1874, 693.17, 693.17,
			 1, 99497, 1883, 512.31, 512.31, 1, 44930, 1892, 171.62, 171.62,
			 1, 80492, 1901, 239.05, 239.05, 1, 40019, 1910, 741.36, 741.36,
			 1, 56816, 1919, 302.65, 302.65, 1, 35832, 1928, 592.51, 592.51,
			 1, 5785, 1937, 726.32, 726.32, 1, 39147, 1946, 755.67, 755.67,
			 1, 84289, 1955, 512.69, 512.69, 1, 92804, 1964, 272.72, 272.72,
			 1, 3508, 1973, 405.51, 405.51, 1, 6239, 1982, 403.28, 403.28,
			 1, 8143, 1991, 470.77, 470.77, 1, 27487, 2000, 679.8, 679.8,
			 1, 2933, 2009, 517.89, 517.89, 1, 50079, 2018, 442.09, 442.09,
			 1, 6357, 2027, 394.86, 394.86, 1, 18587, 2036, 685.75, 685.75,
			 1, 45416, 2045, 381.05, 381.05, 1, 69482, 2054, 404.9, 404.9,
			 1, 64112, 2063, 447.64, 447.64, 1, 92569, 2072, 517.14, 517.14,
			 1, 18736, 2081, 415, 415, 1, 11548, 2090, 377.04, 377.04, 1,
			 77292, 2099, 349.68, 349.68, 1, 11044, 2108, 821.93, 821.93,
			 1, 95102, 2117, 477, 477, 1, 58590, 2126, 181.5, 181.5, 1, 72040,
			 2135, 509.04, 509.04, 1, 45042, 2144, 739.72, 739.72, 1, 43231,
			 2153, 308.53, 308.53, 1, 59794, 2162, 238.25, 238.25, 1, 93016,
			 2171, 583.64, 583.64, 1, 79968, 2180, 544.51, 544.51, 1, 42699,
			 2189, 266.45, 266.45, 1, 76862, 2198, 447.29, 447.29, 1, 74725,
			 2207, 446.75, 446.75, 1, 93729, 2216, 396.29, 396.29, 1, 12855,
			 2225, 481.16, 481.16, 1, 99531, 2234, 233.45, 233.45, 1, 57582,
			 2243, 315.93, 315.93, 1, 39363, 2252, 324.43, 324.43, 1, 22012,
			 2261, 213.98, 213.98, 1, 76945, 2270, 141.24, 141.24, 1, 27002,
			 2279, 408.25, 408.25, 1, 32241, 2288, 679.08, 679.08, 1, 45165,
			 2297, 481.48, 481.48, 1, 93548, 2306, 439.82, 439.82, 1, 63191,
			 2315, 552.09, 552.09, 1, 432, 2324, 593.65, 593.65, 1, 6230,
			 2333, 349.17, 349.17, 1, 42867, 2342, 395.2, 395.2, 1, 60490,
			 2351, 390.94, 390.94, 1, 28760, 2360, 543.34, 543.34, 1, 49157,
			 2369, 911.21, 911.21, 1, 40176, 2378, 648, 648, 1, 30960, 2387,
			 35.89, 89.73, 1, 85195, 2396, 847.81, 847.81, 1, 23934, 2405,
			 174.33, 174.33, 1, 54377, 2414, 435.88, 435.88, 1, 78163, 2423,
			 988.75, 988.75, 1, 89205, 2432, 480.29, 480.29, 1, 96959, 2441,
			 712.32, 712.32, 1, 69823, 2450, 793.26, 793.26, 1, 68310, 2459,
			 283.62, 283.62, 1, 7117, 2468, 271.6, 271.6, 1, 80031, 2477,
			 196.85, 196.85, 1, 72681, 2486, 651.26, 651.26, 1, 7538, 2495,
			 183.46, 183.46, 1, 68151, 2504, 464.06, 464.06, 1, 71123, 2513,
			 304.56, 304.56, 1, 37458, 2522, 554.27, 554.27, 1, 49963, 2531,
			 455.5, 455.5, 1, 64553, 2540, 432.18, 432.18, 1, 60214, 2549,
			 627.62, 627.62, 1, 16188, 2558, 649.78, 649.78, 1, 6995, 2567,
			 355.15, 355.15, 1, 56579, 2576, 446.18, 446.18, 1, 53213, 2585,
			 592.87, 592.87, 1, 67772, 2594, 662.55, 662.55, 1, 42016, 2603,
			 515.66, 515.66, 1, 52259, 2612, 611.5, 611.5, 1, 69011, 2621,
			 243.05, 243.05, 1, 57809, 2630, 252.24, 252.24, 1, 23733, 2639,
			 264.88, 264.88, 1, 78576, 2648, 390.47, 390.47, 1, 14000, 2657,
			 248.71, 248.71, 1, 60889, 2666, 237.25, 237.25, 1, 87501, 2675,
			 453.12, 453.12, 1, 67078, 2684, 111.24, 111.24, 1, 56912, 2693,
			 252.46, 252.46, 1, 2410, 2702, 348.83, 348.83, 1, 2766, 2711,
			 142.8, 142.8, 1, 68591, 2720, 613.05, 613.05, 1, 52207, 2729,
			 331.18, 331.18, 1, 54010, 2738, 540.63, 540.63, 1, 47441, 2747,
			 54.76, 54.76, 1, 24188, 2756, 303.22, 303.22, 1, 60996, 2765,
			 426.87, 426.87, 1, 77259, 2774, 367.43, 367.43, 1, 76199, 2783,
			 236.35, 236.35, 1, 42647, 2792, 132.92, 132.92, 1, 27915, 2801,
			 339.79, 339.79, 1, 55133, 2810, 709.73, 709.73, 1, 45248, 2819,
			 290.35, 290.35, 1, 8068, 2828, 379.95, 379.95, 1, 25272, 2837,
			 268.67, 268.67, 1, 55045, 2846, 325.23, 325.23, 1, 49143, 2855,
			 633.09, 633.09, 1, 81347, 2864, 1016.27, 1016.27, 1, 33101,
			 2873, 137.76, 137.76, 1, 22362, 2882, 278.15, 278.15, 1, 77894,
			 2891, 185.55, 185.55, 1, 71135, 2900, 334.26, 334.26, 1, 97156,
			 2909, 370.44, 370.44, 1, 85722, 2918, 212.51, 212.51, 1, 34002,
			 2927, 411.88, 411.88, 1, 48353, 2936, 234.29, 234.29, 1, 55395,
			 2945, 673.35, 673.35, 1, 96872, 2954, 146.04, 146.04, 1, 73126,
			 2963, 352.02, 352.02, 1, 64544, 2972, 399.78, 399.78, 1, 24682,
			 2981, 302.23, 302.23, 1, 42849, 2990, 360.94, 360.94, 1, 1794,
			 2999, 610.97, 610.97, 1, 26169, 3008, 532.17, 532.17, 1, 87585,
			 3017, 429.05, 429.05, 1, 90807, 3026, 595.88, 595.88, 1, 18371,
			 3035, 307.08, 307.08, 1, 32637, 3044, 194.67, 194.67, 1, 50630,
			 3053, 578.14, 578.14, 1, 40837, 3062, 393.59, 393.59, 1, 16358,
			 3071, 350.02, 350.02, 1, 14323, 3080, 321.4, 321.4, 1, 12356,
			 3089, 96.48, 241.2, 1, 63047, 3098, 202.19, 202.19, 1, 33776,
			 3107, 108.66, 108.66, 1, 30109, 3116, 250.38, 250.38, 1, 46700,
			 3125, 974.81, 974.81, 1, 84756, 3134, 629.91, 629.91, 1, 22831,
			 3143, 478.89, 478.89, 1, 71832, 3152, 1001.82, 1001.82, 1, 70401,
			 3161, 456.7, 456.7, 1, 34382, 3170, 450.3, 450.3, 1, 75319,
			 3179, 414.35, 414.35, 1, 57211, 3188, 378.91, 378.91, 1, 98997,
			 3197, 482.97, 482.97, 1, 90348, 3206, 364.44, 364.44, 1, 80429,
			 3215, 303.06, 303.06, 1, 2711, 3224, 292.68, 292.68, 1, 42408,
			 3233, 173.96, 173.96, 1, 91637, 3242, 252.76, 252.76, 1, 52977,
			 3251, 411.25, 411.25, 1, 69686, 3260, 650.66, 650.66, 1, 99163,
			 3269, 384.13, 384.13, 1, 69541, 3278, 663.56, 663.56, 1, 70312,
			 3287, 135.71, 135.71, 1, 71514, 3296, 234.88, 234.88, 1, 77748,
			 3305, 491.97, 491.97, 1, 73719, 3314, 469.12, 469.12, 1, 71075,
			 3323, 310.99, 310.99, 1, 26850, 3332, 230.68, 230.68, 1, 60277,
			 3341, 273.55, 273.55, 1, 62386, 3350, 607.43, 607.43, 1, 56424,
			 3359, 733.8, 733.8, 1, 15, 3368, 475.92, 475.92, 1, 75295, 3377,
			 321.96, 321.96, 1, 99193, 3386, 317.27, 317.27, 1, 92814, 3395,
			 333.22, 333.22, 1, 87157, 3404, 455.55, 455.55, 1, 62292, 3413,
			 355.43, 355.43, 1, 82753, 3422, 144.6, 144.6, 1, 37405, 3431,
			 375.39, 375.39, 1, 43681, 3440, 781.39, 781.39, 1, 52526, 3449,
			 116.25, 116.25, 1, 1369, 3458, 489.43, 489.43, 1, 21104, 3467,
			 801.5, 801.5, 1, 51209, 3476, 323.72, 323.72, 1, 22862, 3485,
			 392.82, 392.82, 1, 97423, 3494, 827.96, 827.96, 1, 81235, 3,
			 628.53, 628.53, 1, 59109, 12, 341.64, 341.64, 1, 76619, 21,
			 582.6, 582.6, 1, 38504, 30, 586.05, 586.05, 1, 13432, 39, 401.56,
			 401.56, 1, 45437, 48, 139.18, 347.94, 1, 91184, 57, 229.78,
			 229.78, 1, 79628, 66, 310.14, 310.14, 1, 73993, 75, 493.26,
			 493.26, 1, 24903, 84, 170.47, 170.47, 1, 81148, 93, 106.24,
			 106.24))
})

test_that("Test 2: <b>Table 1.</b> Selection Summary results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_selectionInformationTable"]][["data"]]
	expect_equal_tables(table,
		list(9, "11.43%", 400))
})

### TEST 3: SELECTION USING auditRattle.csv DATASET

options <- jasptools::analysisOptions("auditSelection")
options$.meta <- list(additionalVariables = list(containsColumn = TRUE), monetaryVariable = list(
    containsColumn = TRUE), rankingVariable = list(containsColumn = TRUE), 
    recordNumberVariable = list(containsColumn = TRUE), sampleIndicatorColumn = list(
        containsColumn = TRUE))
options$addSampleIndicator <- FALSE
options$displaySample <- TRUE
options$monetaryVariable <- "Deductions"
options$plotHistograms <- TRUE
options$recordNumberVariable <- "ID"
options$sampleDescriptives <- TRUE
options$sampleIndicatorColumn <- ""
options$sampleSize <- 40
options$selectionMethod <- "randomSampling"
options$selectionType <- "musSampling"
set.seed(1)
results <- jasptools::run("auditSelection", "auditRattle.csv", options)


test_that("Test 3: Book values plot matches", {
	plotName <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_plotHistograms"]][["collection"]][["selectionContainer_plotHistograms_Deductions"]][["data"]]
	testPlot <- results[["state"]][["figures"]][[plotName]][["obj"]]
	expect_equal_plots(testPlot, "Test 3: book-values", dir="auditSelection")
})

test_that("Test 3: <b>Table 2.</b> Selection Descriptive Statistics results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleDescriptivesTable"]][["data"]]
	expect_equal_tables(table,
		list(1724.16666666667, 1887, 489.370128335519, 40, "Deductions"))
})

test_that("Test 3: <b>Table 3.</b> Selected Observations results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_sampleTable"]][["data"]]
	expect_equal_tables(table,
		list(1, 1977, 4153176, 29, 1, 1902, 9019764, 73, 1, 1848, 3465197,
			 19, 1, 1098.66666666667, 3813044, 22, 1, 2246, 1222601, 1, 1,
			 1114.66666666667, 4823221, 37, 1, 1060, 3883555, 23, 1, 1559.33333333333,
			 8299017, 68, 1, 1568, 4579400, 36, 1, 2513.33333333333, 6646979,
			 53, 1, 2174, 2511963, 14, 1, 2246, 6924609, 55, 1, 1492, 8304027,
			 69, 1, 1902, 4909545, 38, 1, 1316, 3982518, 25, 1, 1887, 1545759,
			 3, 1, 1367.33333333333, 2434068, 13, 1, 649.333333333333, 4031521,
			 28, 1, 1902, 2242093, 10, 1, 1250.66666666667, 1797445, 5, 1,
			 1068, 9466933, 77, 1, 2174, 2161054, 8, 1, 1564, 4031109, 27,
			 1, 2415, 6078926, 48, 1, 1977, 7618649, 63, 1, 1902, 3406334,
			 17, 1, 2904, 7930929, 65, 1, 1902, 5634257, 43, 1, 1114.66666666667,
			 5293006, 42, 1, 1902, 7547024, 60, 1, 1887, 8095545, 66, 1,
			 1564, 4209493, 31, 1, 1887, 5649072, 44, 1, 2258, 5994090, 46,
			 1, 1147.33333333333, 8554333, 71, 1, 1452.66666666667, 3433750,
			 18, 1, 1160.66666666667, 9126219, 74, 1, 2392, 6219246, 49,
			 1, 1320, 2361729, 12, 1, 1902, 1597428, 4))
})

test_that("Test 3: <b>Table 1.</b> Selection Summary results match", {
	table <- results[["results"]][["selectionContainer"]][["collection"]][["selectionContainer_selectionInformationTable"]][["data"]]
	expect_equal_tables(table,
		list("51.04%", 40, "$ 68967"))
})